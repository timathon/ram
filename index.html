<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pitter-Patter Player</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding: 0;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      font-size: 26px;
      /* margin-bottom: 25px; */
    }

    .section {
      margin-bottom: 20px;
    }

    .file-list {
      margin-left: 20px;
      padding: 0;
    }

    .file-list li {
      margin-bottom: 8px;
      padding: 5px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .file-list li:hover {
      background-color: #f0f0f0;
    }

    .controls {
      /* margin: 15px 0; */
      text-align: center;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      /* padding: 10px 0; */
    }

    .controls button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f5f5f5;
      transition: background-color 0.2s;
      min-width: 120px;
    }

    .controls button:hover {
      background-color: #e0e0e0;
    }

    label {
      margin-right: 10px;
      display: inline-block;
    }

    .file-box {
      border: 1px solid #ccc;
      padding: 15px;
      margin: 15px 0;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .file-box-title {
      font-weight: bold;
      margin-bottom: 12px;
      display: block;
      font-size: 18px;
    }

    .file-list {
      margin-left: 20px;
      padding: 0;
      max-height: 200px;
      /* Adjusted to show approximately 5 items (36px per item) */
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }

    .file-list li {
      margin-bottom: 8px;
      padding: 5px;
      border-radius: 4px;
      transition: background-color 0.2s;
      list-style-type: none;
      line-height: 1.4;
      /* Ensuring consistent line height */
    }

    /* Custom scrollbar styling */
    .file-list::-webkit-scrollbar {
      width: 8px;
    }

    .file-list::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .file-list::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .file-list::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    select {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      /* Fix for flickering dropdowns on Windows browsers */
      background-color: white;
      position: relative;
      z-index: 1;
    }

    #refreshBtn {
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f5f5f5;
      transition: background-color 0.2s;
      min-width: auto;
    }

    #refreshBtn:hover {
      background-color: #e0e0e0;
    }

    #refreshBtn:disabled {
      background-color: #e0e0e0;
      cursor: not-allowed;
    }

    #refreshFileBtn {
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f5f5f5;
      transition: background-color 0.2s;
      min-width: auto;
    }

    #refreshFileBtn:hover {
      background-color: #e0e0e0;
    }

    #refreshFileBtn:disabled {
      background-color: #e0e0e0;
      cursor: not-allowed;
    }

    input[type="number"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .dropdown-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      justify-content: center;
    }

    .dropdown-container>div {
      display: flex;
      flex-direction: column;
      min-width: 150px;
    }

    /* Flex container for section and loop dropdowns */
    .dropdown-container>div:nth-child(3)>div {
      display: flex;
      gap: 15px;
      align-items: end;
      flex-wrap: wrap;
    }

    /* Individual dropdown containers */
    .dropdown-container>div:nth-child(3)>div>div {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 120px;
      /* Ensure minimum width for dropdowns */
    }

    /* Specific style for loop count dropdown */
    #globalLoopCount {
      width: 60px;
    }

    #audio {
      width: 100%;
      margin-top: 15px;
      border-radius: 4px;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      body {
        margin: 10px;
        padding: 5px;
      }

      .dropdown-container {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 10px;
      }

      .dropdown-container>div {
        min-width: auto;
        flex: 1;
        min-width: 120px;
      }

      .dropdown-container>div:nth-child(3) {
        flex: 0 0 100%;
        /* Make section container take full width */
      }

      /* Make section and loop dropdowns appear side-by-side on mobile */
      @media (min-width: 481px) {
        .dropdown-container>div:nth-child(3)>div {
          flex-wrap: nowrap;
        }
      }

      .controls button {
        width: auto;
        padding: 12px;
        min-width: 80px;
        font-size: 14px;
      }

      #infoContainer {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 10px;
        margin-left: 0;
      }

      .file-box {
        padding: 10px;
      }

      .file-list {
        margin-left: 10px;
        max-height: 180px;
        /* Slightly smaller on mobile */
      }

      select,
      input[type="number"] {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        /* Prevents zoom on iOS */
      }
    }

    /* Ensure info container elements stay together on mobile */
    @media (max-width: 480px) {
      #infoContainer {
        width: 100%;
        justify-content: space-between;
      }
      
      #playTimeDisplay,
      #speedControl {
        flex: 1;
        min-width: 120px;
      }
    }
  </style>
  <h1>Pitter-Patter Player</h1>
  <div id="sections">
    <div class="dropdown-container">
      <div>
        <label for="textbookSelect">Textbook:</label>
        <select id="textbookSelect"></select>
      </div>
      <div>
        <label for="unitSelect">Unit:</label>
        <select id="unitSelect"></select>
      </div>
      <div>
        <div style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap;">
          <div>
            <label for="sectionSelect">Section:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <select id="sectionSelect"></select>
              <button id="refreshBtn" title="Refresh file lists">↻</button>
            </div>
          </div>
          <div>
            <label for="globalLoopCount">Loop:</label>
            <select id="globalLoopCount">
              <option value="1" selected>1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="file-box">
      <span class="file-box-title">Files: 0 of 0 selected</span>
      <label style="margin-bottom:0 8px;">
        <input type="checkbox" id="selectAllFiles" checked>
        Select All
      </label>
      <ul id="fileListDiv" class="file-list"></ul>
    </div>



  </div>
  <div class="controls">
    <button id="playBtn">Play Selected</button>
    <button id="refreshFileBtn" title="Refresh current file">↻ Refresh File</button>
  </div>
  <audio id="audio" controls></audio>
  <!-- The UI will be dynamically generated by JavaScript based on the textbook -> unit -> section -> files structure from index.json -->
  <script src="scripts/list.js"></script>
  <script src="scripts/cache.js"></script>
  <script src="scripts/script.js"></script>

  </body>

</html>